<!doctype html><meta charset=utf-8>

<div style=display:none;>
	<svg id=$svg fill="inherit" viewBox="0 0 36 36" xmlns="http://www.w3.org/2000/svg">
		<marker
			id="dot"
			orient="auto"
			viewBox="-8 -8 16 16"
			markerWidth="4"
			markerHeight="4"
			refX="0"
			refY="0"
		>
			<line x1="0" y1="0" x2="0" y2="8" stroke="red" />
		</marker>
		<clipPath id=$me></clipPath>
		
		<path d="M8.556 34.087c.131.787-2.091 1.454-2.376 1.326-.305-.137.988-.808.967-1.226-.106-2.12-.904-1.961-.818-4.18-.802-2.376-.355-4.621-.094-5.42.457-1.401 3.126.756 3.003 1.651-.204 1.488-.792 2.577-.815 3.757.42 1.883-.175 2.244.133 4.092zm7.188-.872c.353.715.726 1.971.416 1.931-.331-.043-1.396-.505-1.736-1.427-.734-1.991-1.747-1.45-2.307-3.6-1.047-1.579-2.402-3.882-2.621-4.478-.509-1.384 3.391-1.737 3.619-.863.5 1.914.509 3.359.829 4.496.949 1.68.971 2.261 1.8 3.941z" fill="#FFDC5D"/><path d="M5.869 26.06c-.158.153-.56.236-.661.211-.235-.06-.764-.427-1.061-.786-.541-.652-2.661-1.333-3.223-2.72-.095-.234-.089-.52.081-.864.104-.21 1.53-2.556 2.831-3.804.427-.41.95-.872 1.569-.929.534-.049 1.055 1.182.826 1.653-.746 1.53-3.005 2.607-3.646 3.488 1.01.804.909 1.315 2.287 2.123.152-.095.45-.177.531-.159.081.018.27.143.241.387.025.018.234.186.283.274.135.239.146.928-.058 1.126zm7.584.126c.173.136.582.178.679.142.227-.083.716-.503.975-.89.472-.704 2.51-1.598 2.928-3.035.071-.243.036-.527-.169-.851-.125-.198-1.643-2.276-2.982-3.484-.356-.321-1.156-1.137-1.565-.788-.408.348-1.364 1.316-1.087 1.761.899 1.446 3.376 2.267 4.104 3.078-.922.903-.77 1.401-2.058 2.346-.161-.078-.466-.13-.545-.104-.079.027-.254.17-.2.409-.023.021-.214.209-.254.301-.109.253-.05.94.174 1.115z" fill="#FFDC5D"/><path d="M14.129 17.359c-.716-.399-1.311-.707-2.415-.707H9.379v.002-.002H7.044c-.678 0-1.529.295-2.354.707.188.617.428 2.106.69 2.996.251.853 1.044 2.154.797 3.158-.134.545-.49 3.675-.326 4.7.906.074 2.079.178 2.955.342.234-.733.443-1.515.429-1.48.238.009.587-.017.803-.065.228.403.951 1.471.951 1.471s1.634-.282 2.792-.564c-.084-1.174-.662-3.612-.917-4.416-.288-.908.354-2.566.515-3.144.148-.535.75-2.998.75-2.998z" fill="#292F33"/><path d="M12.05 17.343c0-.435-.117-.692-.672-.692v-3H7.38v3c-.555 0-.672.257-.672.692 0 .239 0 2.264 2.67 2.265h.003c2.669-.001 2.669-2.026 2.669-2.265z" fill="#FFDC5D"/><path d="M7.379 16.242c.608.687 1.178.859 1.998.859.819 0 1.394-.173 2.002-.859v-.812h-4v.812z" fill="#F9CA55"/><path d="M11.558 2.851c-1.127-.364-3.778-.265-4.441.597-1.723.033-3.745 1.591-4.01 3.645-.262 2.034.322 2.978.53 4.507.236 1.733 1.21 2.287 1.988 2.519 1.12 1.48 2.311 1.417 4.311 1.417 3.905 0 5.765-2.613 5.929-7.051.101-2.684-1.474-4.717-4.307-5.634z" fill="#FFAC33"/><path d="M13.792 8.675c-.378-.523-.862-.944-1.922-1.094.398.182.779.812.828 1.16.05.348.099.63-.215.282-1.261-1.394-2.635-.845-3.996-1.697-.951-.595-1.24-1.253-1.24-1.253s-.117.879-1.558 1.773c-.418.259-.916.837-1.193 1.69-.199.613-.137 1.16-.137 2.094 0 2.728 2.248 5.021 5.021 5.021s5.021-2.313 5.021-5.021c-.001-1.696-.179-2.359-.609-2.955z" fill="#FFDC5D"/><path d="M11.611 14.42H7.148s.558 1.116 2.231 1.116 2.232-1.116 2.232-1.116zm-1.674-1.394H8.821c-.154 0-.279-.125-.279-.279s.125-.279.279-.279h1.116c.154 0 .279.125.279.279s-.125.279-.279.279z" fill="#C1694F"/><path d="M7.148 11.073c-.308 0-.558-.25-.558-.558v-.558c0-.308.25-.558.558-.558.308 0 .558.25.558.558v.558c0 .308-.25.558-.558.558zm4.463 0c-.308 0-.558-.25-.558-.558v-.558c0-.308.25-.558.558-.558s.558.25.558.558v.558c0 .308-.25.558-.558.558z" fill="#662113"/><path d="M4.067.777c2.625-.219 3.75 2.875 3 4.25-1.969 0-3.937-1.813-3-4.25zm9.987.062c-2.625-.219-3.75 2.875-3 4.25 1.969 0 3.938-1.812 3-4.25z" fill="#292F33"/><path d="M6.692 3.902c1.812-1.438 4.344-1.062 5.156.156.031.312-.37 1.178-.688 1.031-.812-.375-2.188-.938-4.063-.062-.092-.063-.44-1.098-.405-1.125zm7.656 29.788c-.386.475.511 1.883 1.188 2.168.564.238 1.545.149 1.842-.446.186-.373-1.04-1.842-1.426-1.931-.386-.089.594.475-.356.564-.683.065-1.248-.355-1.248-.355zm-5.792.397c.505.435.654 1.474-1.069 1.801-1.268.241-2.228.086-2.347-.386-.149-.594 1.485-1.277 1.901-1.366.416-.089-.475.564.238.535.713-.031 1.277-.584 1.277-.584z" fill="#292F33"/><path d="M25.639 34.087c.131.787-2.091 1.454-2.376 1.326-.305-.137.988-.808.967-1.226-.106-2.12-.904-1.961-.818-4.18-.802-2.376-.355-4.621-.094-5.42.457-1.401 3.126.756 3.003 1.651-.204 1.488-.792 2.577-.815 3.757.42 1.883-.175 2.244.133 4.092zm7.188-.872c.353.715.726 1.971.416 1.931-.331-.043-1.396-.505-1.736-1.427-.734-1.991-1.747-1.45-2.307-3.6-1.047-1.579-2.402-3.882-2.621-4.478-.509-1.384 3.391-1.737 3.619-.863.5 1.914.509 3.359.829 4.496.948 1.68.97 2.261 1.8 3.941z" fill="#FFDC5D"/><path d="M22.952 26.06c-.158.153-.56.236-.661.211-.235-.06-.764-.427-1.061-.786-.541-.652-2.661-1.333-3.223-2.72-.095-.234-.089-.52.081-.864.104-.21 1.53-2.556 2.831-3.804.427-.41.95-.872 1.569-.929.534-.049 1.055 1.182.826 1.653-.746 1.53-3.005 2.607-3.646 3.488 1.01.804.909 1.315 2.287 2.123.152-.095.45-.177.531-.159.081.018.27.143.241.387.025.018.234.186.283.274.135.239.146.928-.058 1.126zm7.583.126c.173.136.582.178.679.142.227-.083.716-.503.975-.89.472-.704 2.51-1.598 2.928-3.035.07-.243.036-.527-.169-.851-.125-.198-1.643-2.276-2.982-3.484-.356-.321-1.156-1.137-1.565-.788-.408.348-1.364 1.316-1.087 1.761.899 1.446 3.376 2.267 4.104 3.078-.922.903-.77 1.401-2.058 2.346-.161-.078-.466-.13-.545-.104-.079.027-.254.17-.2.409-.023.021-.214.209-.254.301-.109.253-.049.94.174 1.115z" fill="#FFDC5D"/><path d="M31.149 17.359c-.716-.399-1.311-.707-2.415-.707h-2.335v.002-.002h-2.335c-.678 0-1.529.295-2.354.707.188.617.428 2.106.69 2.996.251.853 1.044 2.154.797 3.158-.134.545-.49 3.675-.326 4.7.906.074 2.079.178 2.955.342.234-.733.443-1.515.429-1.48.238.009.587-.017.803-.065.228.403.951 1.471.951 1.471s1.634-.282 2.792-.564c-.084-1.174-.662-3.612-.917-4.416-.288-.908.354-2.566.515-3.144.148-.535.75-2.998.75-2.998z" fill="#292F33"/><path d="M29.133 17.343c0-.435-.117-.692-.672-.692v-3h-3.998v3c-.555 0-.672.257-.672.692 0 .239 0 2.264 2.67 2.265h.003c2.669-.001 2.669-2.026 2.669-2.265z" fill="#FFDC5D"/><path d="M24.462 16.242c.608.687 1.178.859 1.998.859.819 0 1.394-.173 2.002-.859v-.812h-4v.812z" fill="#F9CA55"/><path d="M28.641 2.851c-1.127-.365-3.778-.265-4.441.597-1.723.033-3.745 1.591-4.01 3.645-.262 2.034.322 2.978.53 4.507.236 1.733 1.21 2.287 1.988 2.519 1.12 1.48 2.311 1.417 4.311 1.417 3.905 0 5.765-2.613 5.929-7.051.101-2.684-1.474-4.717-4.307-5.634z" fill="#FFAC33"/><path d="M30.874 8.675c-.378-.523-.862-.944-1.922-1.094.398.182.779.812.828 1.16.05.348.099.63-.215.282-1.261-1.394-2.635-.845-3.996-1.697-.951-.595-1.24-1.253-1.24-1.253s-.116.878-1.558 1.773c-.418.259-.916.837-1.193 1.69-.199.613-.137 1.16-.137 2.094 0 2.728 2.248 5.021 5.021 5.021s5.021-2.313 5.021-5.021c0-1.696-.178-2.359-.609-2.955z" fill="#FFDC5D"/><path d="M28.693 14.42H24.23s.558 1.116 2.232 1.116c1.674 0 2.231-1.116 2.231-1.116zm-1.673-1.394h-1.116c-.154 0-.279-.125-.279-.279s.125-.279.279-.279h1.116c.154 0 .279.125.279.279s-.125.279-.279.279z" fill="#C1694F"/><path d="M24.23 11.073c-.308 0-.558-.25-.558-.558v-.558c0-.308.25-.558.558-.558.308 0 .558.25.558.558v.558c0 .308-.25.558-.558.558zm4.463 0c-.308 0-.558-.25-.558-.558v-.558c0-.308.25-.558.558-.558.308 0 .558.25.558.558v.558c0 .308-.25.558-.558.558z" fill="#662113"/><path d="M21.15.777c2.625-.219 3.75 2.875 3 4.25-1.969 0-3.938-1.813-3-4.25zm9.987.062c-2.625-.219-3.75 2.875-3 4.25 1.969 0 3.938-1.812 3-4.25z" fill="#292F33"/><path d="M23.775 3.902c1.812-1.438 4.344-1.062 5.156.156.031.312-.37 1.178-.688 1.031-.812-.375-2.188-.938-4.063-.062-.093-.063-.44-1.098-.405-1.125zm7.656 29.788c-.386.475.511 1.883 1.188 2.168.564.238 1.545.149 1.842-.446.186-.373-1.04-1.842-1.426-1.931-.386-.089.594.475-.356.564-.683.065-1.248-.355-1.248-.355zm-5.792.397c.505.435.654 1.474-1.069 1.801-1.268.241-2.228.086-2.347-.386-.149-.594 1.485-1.277 1.901-1.366.416-.089-.475.564.238.535.712-.031 1.277-.584 1.277-.584z" fill="#292F33"/>
	<path d="M5,6 h10v10h-10z" fill="#FFDC5D"/>	
	</svg>
</div>

<style>
	html, body {
		position: fixed;
		margin: 0;
		width: 100%;
		height: 100%;
	}
	#\$box {
		display: grid;
		width: 100%;
		height: 100%;
		grid-area: box;
	}
	#\$orig {
		display: grid;
		width: 100%;
		height: 100%;
		grid-area: orig;
	}
	#\$box > * {
		grid-area: 1/1/1/1;
	}
	#\$list {
		overflow-y: scroll;
		display: flex;
		flex-flow: row wrap;
		align-content: flex-start;
		grid-area: layers;
	}
	main {
		display: grid;
		grid-template:
			"orig layers" 180px
		"box layers" 180px
		"extra layers" 1fr
		/ 180px 1fr;
		height:100%;
	}
	drag-item {
		border: 2px outset salmon;
		height: 72px;
		display: grid;
		grid-template:
			"svg g1 g2 g3 extra" 20px
		"svg col col col col" 1fr
		/ 72px 20px 20px 20px 1fr;
		grid-auto-flow: row;
		place-items: center start;
	}
	label {
		position: relative;
		width: 100%;
		height: 100%;
		user-select: none;
	}
	label > * {
		display: block;
		box-sizing: border-box;
		margin: 0;
		width: 100%;
		height: 100%;
	}
	input[type=checkbox] {
		appearance: none;
		opacity: 0;
		cursor: pointer;
		touch-action: manipulation;
		position: absolute;
	}
	label > input + span {
		text-align: center;
		color: gray;
		background: lavender;
	}
	label > input:checked + span {
		font-weight: bold;
		background: #2A2;
		color: white;
	}
	label > input:checked[value=male] + span {
		background: #44B;
	}
	label > input:checked[value=female] + span {
		background: #C48;
	}
	drag-item > svg {
		width: 72px;
		height: 72px;
		grid-area: svg;
		paint-order: stroke;
		stroke: currentColor;
	}
	li {
		flex: none;
		width: 150px;
		height: 90px;
		display: block;
		margin: 0;
		padding: 0;
	}
	li.drop {
		background: #FF02;
		outline: 2px dotted yellow;
		outline-offset: -2px;
	}
	li.drop > * {
		opacity: 0.5;
	}
	drag-item.dragging {
		outline: 2px dotted yellow;
		outline-offset: -2px;
	}
	
</style>

<main>
	<div id=$orig></div>
	<div id=$box></div>
	<ol id=$list></ol>
</main>

<script>
	/*document.ondragover = ev=>{
		if (ev.dataTransfer.types.includes("Files")) {
			ev.preventDefault()
			ev.dataTransfer.dropEffect = 'copy'
		}
	}
	document.ondrop = ev=>{
		if (ev.dataTransfer.files.length) {
			ev.preventDefault()
			upload(ev.dataTransfer.files)
		}
	}*/
	
	function clean_rows() {
		let layers = []
		for (let x of $list.children) {
			layers.push(x.firstElementChild.firstElementChild._sister)
		}
		layers.reverse()
		$box.replaceChildren(...layers)
	}
	
	let dragging
	function dropzone(cell) {
		let n = false
		cell.ondragover = ev=>{
			ev.dataTransfer.dropEffect = 'move'
			ev.preventDefault()
		}
		cell.ondrop = ev=>{
			if (dragging && ev.dataTransfer.getData('text/x-drag')) {
				cell.classList.remove('drop')
				dragging.classList.remove('dragging')
				let d = dragging
				dragging = null
				let p = d.parentNode
				if (cell.firstChild) {
					if (!p) return
					p.append(cell.firstChild)
				}
				cell.append(d)
				window.setTimeout(x=>clean_rows($list), 0)
			} else {
				console.log('idk?', ev, dragging)
			}
		}
		cell.ondragenter = ev=>{
			if (dragging && ev.dataTransfer.getData('text/x-drag')) {
				if (cell.contains(ev.relatedTarget))
					return
				cell.classList.add('drop')
				ev.preventDefault()
			}
		}
		cell.ondragleave = ev=>{
			if (cell.contains(ev.relatedTarget))
				return
			cell.classList.remove('drop')
		}
	}
	document.ondragend = ev=>{
		if (dragging) {
			dragging.classList.remove('dragging')
			dragging = null
		}
	}
	$list.ondragstart = ev=>{
		if (ev.target.tagName=='DRAG-ITEM') {
			dragging = ev.target
			ev.target.classList.add('dragging')
			ev.dataTransfer.setData('text/x-drag', 1)
			ev.dataTransfer.effectAllowed = 'move'
		}
	}
	
	function dlayer(elem) {
		let l = document.createElement('drag-item')
		l.setAttribute('draggable', true)
		l.append(elem)
		let gs = ['neutral','male','female'].map(x=>{
			let i = document.createElement('input')
			i.type = 'checkbox'
			i.name = 'genders'
			i.value = x
//			i.checked = true
			let l = document.createElement('label')
			let v = document.createElement('span')
			v.textContent = {neutral:'X',male:'M',female:'F'}[x]
			l.prepend(i,v)
			return l
		})
		l.append(...gs)
		
		let m = document.createElement('li')
		dropzone(m)
		m.append(l)
		
		return m
	}
	
	let svg = $svg
	let ii=0
	for (let c of [...svg.children].reverse()) {
		if (c.nodeName=='marker' || c.nodeName=='clipPath')
			continue
			
		c.setAttribute('marker-mid', 'url(#dot)')
		let clip = $me.cloneNode()
		clip.append(c.cloneNode(true))
		clip.setAttribute('id', 'id'+(ii))
		svg.append(clip)
		c.setAttribute('clip-path', 'url(#'+'id'+(ii)+")")
		ii++
		c.setAttribute('marker-start', 'url(#dot)')
		let p = svg.cloneNode(false)
		p.append(c.cloneNode(true))
		let q = p.cloneNode(true)
		q.style.stroke=c.getAttribute('fill')
		q._sister = p
		$box.append(p)
		$list.append(dlayer(q))
	}
	clean_rows()
	$orig.append($svg)
</script>
todo:
- diff between orig/edited
- show all gender variants etc.
- color selector, skin colors, predefined palettes

